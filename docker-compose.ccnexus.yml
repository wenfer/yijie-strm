# CloudDrive2 兼容网关 - Docker Compose 配置
version: '3.8'

services:
  ccnexus:
    # 使用本地构建的镜像，或从 registry 拉取
    image: ccnexus:latest
    container_name: ccnexus
    restart: unless-stopped
    ports:
      - "3021:8115"
    volumes:
      - ./data:/data
      # Cookie 文件存储目录
      - ./cookies:/root/.strm_gateway
    environment:
      # 服务配置
      - GATEWAY_HOST=0.0.0.0
      - GATEWAY_PORT=8115
      - GATEWAY_DEBUG=false
      
      # 数据库配置 (SQLite)
      - DB_URL=sqlite:///data/strm_gateway.db
      
      # STRM 基础 URL (修改为你的实际地址)
      - STRM_BASE_URL=http://your-server-ip:3021/stream
      
      # 管理员账号
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=123456
      
      # 日志级别
      - LOG_LEVEL=INFO
      
      # CORS 配置
      - ENABLE_CORS=true
      
      # 时区
      - TZ=Asia/Shanghai
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8115/api/system/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
