# å¤šç½‘ç›˜ STRM ç½‘å…³ v3.0

åŸºäº FastAPI + Tortoise ORM + p115client æ„å»ºçš„å¤šç½‘ç›˜ STRM æ–‡ä»¶ç”Ÿæˆå’Œæµåª’ä½“ç½‘å…³ç³»ç»Ÿã€‚

## ç‰¹æ€§

- ğŸš€ **FastAPI é©±åŠ¨**: é«˜æ€§èƒ½å¼‚æ­¥ API
- ğŸ“¦ **Tortoise ORM**: ç°ä»£åŒ–å¼‚æ­¥ ORM
- ğŸ“ **STRM ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆ STRM æ–‡ä»¶ä¾›åª’ä½“æœåŠ¡å™¨ä½¿ç”¨
- ğŸ¬ **302 æµåª’ä½“**: æ”¯æŒ 302 é‡å®šå‘çš„æµåª’ä½“æœåŠ¡
- â° **ä»»åŠ¡è°ƒåº¦**: åŸºäº APScheduler çš„å®šæ—¶ä»»åŠ¡
- ğŸ”Œ **å¤šç½‘ç›˜æ”¯æŒ**: æ¶æ„æ”¯æŒå¤šç§ç½‘ç›˜ï¼ˆç›®å‰æ”¯æŒ 115ï¼‰

## ç¯å¢ƒè¦æ±‚

- Python 3.13+
- Node.js 18+ (å‰ç«¯å¼€å‘)


## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js   â”‚â”€â”€â”€â”€â–¶â”‚   FastAPI   â”‚â”€â”€â”€â”€â–¶â”‚  p115client â”‚
â”‚   Frontend  â”‚â—€â”€â”€â”€â”€â”‚    API      â”‚â—€â”€â”€â”€â”€â”‚   115 API   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Tortoise   â”‚
                     â”‚    ORM      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API æ¥å£

### åŸºç¡€æ¥å£

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/drives` | GET/POST | ç½‘ç›˜åˆ—è¡¨/åˆ›å»ºç½‘ç›˜ |
| `/api/files/list` | GET | æ–‡ä»¶åˆ—è¡¨ |
| `/api/tasks` | GET/POST | ä»»åŠ¡åˆ—è¡¨/åˆ›å»ºä»»åŠ¡ |
| `/stream/{pick_code}` | GET | æµåª’ä½“æ’­æ”¾ |

### äº‘ä¸‹è½½æ¥å£

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/offline/list` | GET | è·å–äº‘ä¸‹è½½ä»»åŠ¡åˆ—è¡¨ |
| `/api/offline/add-url` | POST | æ·»åŠ  URL ä¸‹è½½ä»»åŠ¡ |
| `/api/offline/remove` | POST | åˆ é™¤ä¸‹è½½ä»»åŠ¡ |
| `/api/offline/quota` | GET | è·å–é…é¢ä¿¡æ¯ |

### CloudDrive2 å…¼å®¹æ¥å£

ç”¨äºæ›¿æ¢å…¶ä»–ç³»ç»Ÿä¸­ CloudDrive2 çš„ç¦»çº¿ä¸‹è½½æœåŠ¡åœ°å€ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/files/offsline/download` | POST | æ·»åŠ ç¦»çº¿ä¸‹è½½ä»»åŠ¡ |
| `/api/files/offsline/list` | GET | è·å–ç¦»çº¿ä»»åŠ¡åˆ—è¡¨ |
| `/api/files/offsline/remove` | DELETE | åˆ é™¤ç¦»çº¿ä»»åŠ¡ |
| `/api/files/offsline/clear` | GET | æ¸…ç©ºç¦»çº¿ä»»åŠ¡ |

**ä½¿ç”¨ç¤ºä¾‹**:

```bash
# æ·»åŠ ç£åŠ›é“¾ä¸‹è½½
curl -X POST http://localhost:8115/api/files/offsline/download \
  -H "Content-Type: application/json" \
  -d '{
    "path": "/downloads",
    "url": "magnet:?xt=urn:btih:..."
  }'
```

å°†å…¶ä»–ç³»ç»Ÿä¸­ CloudDrive2 çš„åœ°å€ `http://clouddrive2:19798` æ›¿æ¢ä¸ºæœ¬æœåŠ¡åœ°å€ `http://yijie-strm:8115` å³å¯ã€‚

## è®¸å¯è¯

MIT License

## ç›¸å…³é¡¹ç›®

- [p115client](https://github.com/ChenyangGao/p115client) - 115 ç½‘ç›˜ Python å®¢æˆ·ç«¯
